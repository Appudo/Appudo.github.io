{"foot":"<style name=\"stl_master_nodes\">\n    #result span, #thdr span {\n        display: table-cell;\n        width:120px;\n        border-right:1px solid black;\n        border-top:1px solid black;\n        margin:0;\n        padding:5px;\n        word-break: break-all;\n        white-space: initial;\n        height:100%;\n    }\n    \n    #thdr span {\n        font-weight:bold;\n        padding-bottom:5px;\n        border-top:1px solid black;\n        border-bottom:1px solid black;\n    }\n    \n    #thdr, #result {\n        display:inline-block;\n        border-left:1px solid black;\n        white-space: nowrap;\n    }\n    \n    #result {\n        border-bottom:1px solid black;\n    }\n    #result li {\n        list-style-type:none;\n        float:left;\n        clear:both;\n    }\n    #result div {\n        float:right;\n        display:inline-block;\n        width:0px;\n        height:100%;\n        line-height:100%;\n        padding-top:8px;\n        padding-left:5px;\n        margin-right:-5px;\n    }\n    #result a {\n        font-family: symbols;\n        text-decoration: none;\n        color:inherit;\n    }\n</style>","body": {"minit":"<script>minit('master_nodes',['other','content'], {srefs:['content'],sid:'stl_master_nodes'});</script>","misc":"<script>moduleCtx['master_nodes']=function(){\n    return {\n        master:null,\n        hasAsk:false,\n        items:[],\n        renderFull : function(ty) {\n            var data = this.items;\n            $('#result').text('');\n            for(var i = 0; i < data.length; i++) {\n                if(data[i].e == undefined) {\n                    this.renderNode(ty, data[i])\n                }\n            }\n        },\n        renderNode : function(ty, item) {\n            var data;\n            if(ty == 0) {\n                data = '<li><span>' + item.id + '</span><span>' + item.ty + '</span></li>';\n            }  else {\n                data = '<li><span>' + item.id + '</span><span>' + item.name + '</span><span>' + item.ipv4 + '</span><span>' + item.ty + '</span></li>';\n            }\n            $('#result').append(data);\n        },\n        setupHdr : function(ty) {\n            var hdr = $('#thdr')\n            if(ty == 0) {\n                hdr.html('<span>NodeID</span><span>Type</span>');\n            }  else {\n                hdr.html('<span>NodeID</span><span>Name</span><span>IPv4</span><span>Type</span>');\n            }\n            $('#result').text('');\n        },\n        onChange : function(val) {\n            this.listNodes(val);\n        },\n        listNodes : function(ty) {\n            var _this = this;\n            this.setupHdr(ty);\n            post('https://' + this.master + '/admin/', {data:'{\"cmd\":1, \"data\":' + JSON.stringify(JSON.stringify({ty:ty})) + '}'}, function(data) {\n                if(data.r == 0) {\n                    _this.items = data.d;\n                    _this.renderFull(ty);\n                } else {\n                    // TODO error\n                }\n            });\n        },\n        doRemove : function(id) {\n            /*\n            console.log('doRemove', id);\n            var _this = this;\n            post('https://' + this.master + '/admin/', {data:'{\"cmd\":3,\"data\":\"' + id + '\"}'}, function(data) {\n                if(data.r == 0) {\n                    _this.items = _this.items.filter(function(obj) {\n                        return obj.aid != id;\n                    });\n                    _this.renderFull();\n                    _this.hideAsk();\n                } else {\n                    // TODO error\n                }\n            });\n            */\n        },\n        ask : function(id, host) {\n            var _this = this;\n            var rem = $('#theRemove');\n            var val = $('#dval');\n            var ok = $('#ok');\n            rem.css('display', '');\n            val.text(host);\n            disableMain();\n            ok.unbind('click');\n            ok.click(function(){_this.doRemove.call(_this, id);});\n            this.hasAsk = true;\n            rem.focus();\n        },\n        hideAsk : function() {\n            if(this.hasAsk) {\n                $('#theRemove').css('display', 'none');\n                this.hasAsk = false;\n                enableMain();\n            }\n        },\n        run : function() {\n            var _this = this;\n            var sel = $('#selty');\n            var a = window.location.host.split('.');\n            a = a.splice(a.length - 2);\n            this.master = 'mtr.' + a.join('.');\n            \n            this.listNodes(0);\n            $('#rej').click(function(){_this.hideAsk.call(_this);});\n            sel.change(function(){_this.onChange.call(_this, parseInt(sel.val()));});\n        }\n    }\n}();</script>","other":"<div id=\"theRemove\" style=\"display:none;\" class=\"modal\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"disableModal\" aria-hidden=\"true\"><div class=\"dlg\"><div class=\"ltop\"><span>{{rem.rly}}</span></div><div style=\"margin-top:20px;\"><label style=\"margin-right:5px;\">{{rem.dsh}}</label><span id=\"dval\"></span></div><div class=\"frm btn\"><button type=\"button\" name=\"ok\" id=\"ok\">{{rem.sub}}</button><span style=\"width:20px;display:inline-block;\"></span><button type=\"button\" name=\"rej\" id=\"rej\">{{rem.rej}}</button></div></div></div>","content":"<div class=\"linner\"><h3>{{rem.head}}</h3><pre>{{rem.txt}}</pre><div><select id=\"selty\"><option value=\"0\">Connected</option><option value=\"1\">Registered</option><option value=\"2\">Pending</option></select></div><div id=\"thdr\" style=\"margin-top:20px;\"></div><div><ul id=\"result\"></ul></div></div>"}}