{"head":"\n    <style name=\"mstl\">\n        #state label {\n            font-weight:bold;\n            margin-right:10px;\n        }\n        #theForm {\n            display:none;\n        }\n\n        #psk {\n            display:inline-block;\n            width:500px;\n            word-wrap:break-word;\n        }\n        \n        #frmBox {\n            display:inline-block;\n            padding:10px;\n            background:#efefef;  \n            -pie-background: linear-gradient(top,#efefef 0%,#e2e2e2 100%); \n            background:-webkit-gradient(linear, left top, left bottom, color-stop(0%,#efefef), color-stop(100%,#e2e2e2));\n            background:-webkit-linear-gradient(top,#efefef 0%,#e2e2e2 100%);\n            background:-moz-linear-gradient(top,#efefef 0%,#e2e2e2 100%);\n            background:-ms-linear-gradient(top,#efefef 0%,#e2e2e2 100%);\n            background:linear-gradient(top,#efefef 0%,#e2e2e2 100%);\n            background:-o-linear-gradient(top,#efefef 0%,#e2e2e2 100%);\n            border-radius:3px;\n            border:1px solid #223560;\n        }\n    </style>\n","body": {"minit":"<script>minit('status',['content'], []);</script>","misc":"<script>moduleCtx['status']=function(){\n    return {\n        state:0,\n        getStatus : function() {\n            var _this = this;\n            var val = $(\"#val\");\n            var ver = $(\"#ver\");\n            var psk = $(\"#psk\");\n            var nname = $(\"#nname\");\n            var frm = $('#theForm');\n            if($('#status_unique_34233').length == 0)\n                return;\n            showLoad();\n            $.post( \"/server/\", {data:'{\"cmd\":0}'}, function(res) {\n                var data = validateRes(res);\n                if(!data) {\n                    // TODO error\n                    return;\n                }\n                state = data.s;\n                switch(state) {\n                    default:\n                    case 0: // NONE\n                        res = _this.i18n.sts.non;\n                        break;\n                    case 1: // PENDING\n                        res = _this.i18n.sts.pen;\n                        break;\n                    case 2: // OK\n                        res = _this.i18n.sts.rdy;\n                        break;\n                    case 3: // FAILED\n                        res = _this.i18n.sts.fail;\n                        break;\n                }\n                var vd = data.v;\n                var vs = vd.split(/[\\(,\\)]+/)\n                var d = new Date(parseInt(vs[1], '16') * 1000);\n                val.text(res);\n                ver.text(vs[0] + '(' + d.toLocaleString() + ')');\n                psk.text(data.p)\n                nname.text(data.n)\n                hideLoad();\n                if(state == 3) {\n                    frm.css('display', 'block');\n                } else {\n                    frm.css('display', '');\n                }\n                \n                if(state == 1) {\n                    setTimeout(function(){_this.getStatus.apply(_this)}, 2000);\n                }\n            });\n        },\n        retry:function() {\n            var _this = this;\n            var frm = $('#theForm');\n            frm.css('display', '');\n            $.post( \"/server/\", {data:'{\"cmd\":7}'}, function(res) {\n                _this.getStatus.call(_this);\n            });\n        },\n        rstFrm : function(frm) {\n            this.rstFrmErr(frm);\n            frm[0].reset();\n        },\n        rstFrmErr : function(frm) {\n            // TODO remove error messages\n        },\n        doUpdate:function(fdata) {\n            var nname = $(\"#nname\");\n            var _this = this;\n            showLoad();\n            $.post( '/server/', {data:JSON.stringify({cmd:14,data:fdata.nm})}, function(res) {\n                hideLoad(); \n                var data = validateRes(res);\n                if(!data) {\n                    return;\n                }\n                if(data.r == 0) {\n                    nname.text(fdata.nm);\n\t\t            _this.rstFrm($('#updForm'));\n                } else {\n                    // TODO error\n                }\n            });\n        },\n        run : function() {\n            var _this = this;\n            this.getStatus();\n            $('#retry').click(function() {_this.retry.apply(_this)});\n            var frm = $('#updForm');\n               \n            frm.submit(function(e) {\n                e.preventDefault();\n                _this.doUpdate.call(_this, frm.serializeJSON());\n            });\n        }\n    }\n}();</script>","content":"\n    <h3>{{sts.head}}</h3>\n    <pre>{{sts.txt}}</pre>\n    <div id=\"state\">\n        <label>{{sts.ver}}:</label><span id=\"ver\"></span>\n        <div style=\"margin:10px;\"></div>\n        <label>{{sts.nname}}:</label><span id=\"nname\"></span>\n        <div style=\"margin:10px;\"></div>\n        <label style=\"display:inline-block;vertical-align:top;\">{{sts.psk}}:</label><span id=\"psk\"></span>\n        <div style=\"margin:10px;\"></div>\n        <label>{{sts.lbl}}:</label><span id=\"val\"></span>\n    </div>\n    <div>\n        <form id=\"theForm\" class=\"frm\">\n            <button id=\"retry\" name=\"retry\" type=\"button\" style=\"margin-top:15px;\">{{frm.rty}}</button>\n        </form>\n        <div style=\"clear:both;\"></div>\n        <div id=\"frmBox\" style=\"margin-top:40px;padding-bottom:20px;\">\n            <form id=\"updForm\" class=\"frm\">\n                <input id=\"nm\" name=\"nm\" style=\"width:400px;\" placeholder=\"{{sts.nname}}\" required=\"\">\n                <button id=\"sub\" name=\"sub\" type=\"submit\" style=\"margin-top:15px;\">{{frm.sub}}</button>\n            </form>\n            <div style=\"clear:both;\"></div>\n        </div>\n    </div>\n    <div id=\"status_unique_34233\"></div>\n"}}
