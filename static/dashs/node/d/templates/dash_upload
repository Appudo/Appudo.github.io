{"head":"\n    <style name=\"mstl\">\n        #frmBox {\n            display:inline-block;\n            padding:10px;\n            background:#efefef;\n            -pie-background: linear-gradient(top,#efefef 0%,#e2e2e2 100%);\n            background:-webkit-gradient(linear, left top, left bottom, color-stop(0%,#efefef), color-stop(100%,#e2e2e2));\n            background:-webkit-linear-gradient(top,#efefef 0%,#e2e2e2 100%);\n            background:-moz-linear-gradient(top,#efefef 0%,#e2e2e2 100%);\n            background:-ms-linear-gradient(top,#efefef 0%,#e2e2e2 100%);\n            background:linear-gradient(top,#efefef 0%,#e2e2e2 100%);\n            background:-o-linear-gradient(top,#efefef 0%,#e2e2e2 100%);\n            border-radius:3px;\n            border:1px solid #223560;\n        }\n        #ubox {\n            background:#e2e2e2;\n            border-radius:2px;\n            border:1px solid #223560;\n            height:30px;\n            text-align:center;\n            padding-top:5px;\n        }\n        #ubox.drop {\n            background:#b0b0b0;\n        }\n        #box1, #box2 {\n            padding:20px;\n        }\n        #box2 {\n            border-left:1px solid black;\n        }\n        .ldiv {\n            margin: 7px 10px 5px 10px;\n            float:left;\n        }\n        #progOuter {\n            padding:0;\n            background:rgba(30, 30, 30, 0.13);\n            border:1px solid #ddd;\n            border-radius:4px;\n            margin-top:10px;\n            text-align:center;\n        }\n        #progPercent {\n            display: inline-block;\n            line-height: 30px;\n            vertical-align: bottom;\n            width:250px;\n            white-space:nowrap;\n            overflow:hidden;\n            text-overflow:ellipsis;\n        }\n        #progInner {\n            display:inline-block;\n            width:30px;\n            height:30px;\n            padding:0;\n            position:absolute;\n            background:rgba(53, 53, 53, 0.23);\n        }\n    </style>\n","body": {"minit":"<script>minit('dash_upload',['other','content'], []);</script>","misc":"<script>moduleCtx['dash_upload']=function(){\n    return {\n        files:{},\n        cFile:null,\n        progress:null,\n        doValidate : function(pdata, after) {\n            showLoad();\n            $.post('/server/', {data:'{\"cmd\":8,\"data\":' + JSON.stringify(pdata) + '}'}, function(res) {\n                hideLoad();\n                var data = validateRes(res);\n                if(!data) {\n                    return;\n                }\n                after(data);\n            });\n        },\n        rstFrm : function(frm) {\n            this.rstFrmErr(frm);\n            frm[0].reset();\n        },\n        rstFrmErr : function(frm) {\n            // TODO remove error messages\n        },\n        validateFrm : function(frm) {\n            var _this = this;\n            var data = frm.serializeJSON();\n            console.log(data);\n            if(data.up != data.upr) {\n                //TODO add password error message\n                    alert('error');\n                return;\n            }\n            if(data.di && data.ds == '') {\n                //TODO add disk size error message\n                    alert('error');\n                return;\n            }\n            if(data.se && data.sn == '') {\n                //TODO need ssl name error message\n                    alert('error');\n                return;\n            }\n\n            if(data.se) {\n                if(!data.sc && (!_this.files.ssk || !_this.files.ssc)) {\n                    //TODO need ssl files error message\n                    alert('error');\n                    return;\n                }\n            } else\n            if(this.files.ssk || this.files.ssc) {\n                //TODO do not need ssl files error message\n                    alert('error');\n                return;\n            }\n\n            if(data.eo && data.on == '') {\n                //TODO need owner name error message\n                    alert('error');\n                return;\n            }\n            var after = function() {\n                delete data['upr'];\n                _this.doSubmit.call(_this, data);\n            };\n            var hf = this.files.ssk || this.files.ssc || this.files.pkg;\n            if(hf) {\n                this.doValidate({an:data.an,dn:data.dn,sn:data.sn,on:data.on,se:data.se,eo:data.eo}, after);\n            } else {\n                after();\n            }\n        },\n        showProgress : function (v) {\n            if(v)\n            {\n                $('#progPercent')[0].innerText = '0%';\n            }\n\n            $('#theUpload').css('display', v ? 'block' :'none');\n        },\n        setProgress : function(v) {\n            v = Math.round(v);\n            this.progress.p[0].innerText = v + '%';\n            this.progress.i.css('width', Math.round((this.progress.o.width()*v)/100) + 'px');\n        },\n        errSubmit : function(data) {\n                // todo submit ERROR\n                    alert('error');\n        },\n        finSubmit : function() {\n                    this.setProgress(100);\n                    this.showProgress(false);\n                    this.rstFrm($('#theFrm'));\n        },\n        doSubmit : function(data) {\n            this.setProgress(0);\n            this.showProgress(true);\n            var _this = this;\n                        var fd = new FormData();\n                        fd.append('data', JSON.stringify({cmd:2,data:JSON.stringify(data)}));\n                        if(this.files.ssk) {\n                            fd.append('name', 'ssk');\n                            fd.append('ssk', this.files.ssk);\n                        }\n                        if(this.files.ssc) {\n                            fd.append('name', 'ssc');\n                            fd.append('ssc', this.files.ssc);\n                        }\n                        if(this.files.pkg) {\n                            fd.append('name', 'pkg');\n                            fd.append('pkg', this.files.pkg);\n                        }\n                var xhr = new XMLHttpRequest();\n                var stop = $('#abt');\n\n            stop.unbind('click');\n            stop.click(function(e) {\n                e.preventDefault();\n                xhr.abort();\n            });\n\n                xhr.upload.addEventListener('progress', function(e) {\n                        if(e.lengthComputable) {\n                                var p = (e.loaded * 100 / (e.total));\n                                _this.setProgress.call(_this, p);\n                        }\n                }, false);\n\n                xhr.addEventListener('load', function() {\n                    var response = {r:0};\n                                var ioArgs = xhr.ioArgs;\n                    if(xhr.status == 200) {\n                        var response = validateRes(xhr.responseText);\n                    if(!response) {\n                        return;\n                    }\n                    }\n                                if(response.r == 0)\n                                {\n                                    _this.finSubmit.call(_this);\n                                }\n                                else\n                                {\n                                    _this.errSubmit.call(_this, response);\n                                }\n                }, false);\n                xhr.addEventListener('error', function() {\n                        _this.errSubmit.call(_this);\n                }, false);\n                xhr.addEventListener('abort', function() {\n                                _this.showProgress.call(_this, false);\n                }, false);\n            xhr.open('POST', '/server/', true);\n                xhr.send(fd);\n        },\n        handleFiles : function(items, idx) {\n            if(items) {\n                if(idx < items.length) {\n                        var _this = this;\n                        var theFile = $('#theFile');\n                        var file = items[idx];\n                        cFile = file;\n                    theFile.off('onFileReady');\n                    theFile.on('onFileReady', function() {\n                        _this.handleFiles.call(_this, items, idx + 1);\n                    });\n                        $('#theFile').css('display', 'block');\n                        $('#flval').text(file.name);\n                }\n            } else {\n                // TODO file add error\n                    alert('error');\n            }\n        },\n        parseFileList : function(list) {\n            var info = {};\n            var result = [];\n                        for(var i = 0, len = list.length; i < len; i++) {\n                                if(list[i].webkitGetAsEntry && list[i].kind=='file') {\n                                        var item = list[i].webkitGetAsEntry();\n                                        if(item) {\n                                                this.parseFiles(info, item,result);\n                                                if(info.error)\n                                                    return null;\n                                        }\n                                }\n                        }\n                        return info.error ? null : result;\n                },\n        parseFiles : function(info, item, result) {\n            if(info.error)\n                return;\n                        if(item.isFile) {\n                            result.push(item);\n                        } else\n                        if(item.isDirectory) {\n                                var rd = item.createReader();\n                        rd.readEntries(function(items, a) {\n                                        if(items.length != 0) {\n                                        var l = [];\n                                        for(var i = 0, len = items.length; i< len; i++) {\n                                            this.parseFiles(info, items[i], result);\n                                            if(info.error)\n                                                return;\n                                        }\n                                        }\n                                }, function(){\n                                    info.error = true;\n                                    //doUploadEnd(info);\n                                });\n                        }\n                },\n                updFiles : function() {\n                    var pf = this.files.pkg;\n                    var ck = this.files.ssk;\n                    var cc = this.files.ssc;\n                    var no = this.i18n.frm.no;\n                    $('#pf').text(pf ? pf.name : no);\n                    $('#ck').text(ck ? ck.name : no);\n                    $('#cc').text(cc ? cc.name : no);\n                },\n        run : function() {\n            var _this = this;\n            var frm = $('#theFrm');\n            var theFile = $('#theFile');\n            this.progress = {o:$('#progOuter'),i:$('#progInner'),p:$('#progPercent')};\n\n            frm.submit(function(e) {\n                e.preventDefault();\n                _this.validateFrm.call(_this, frm);\n            });\n\n            var cluf = function() {\n                theFile.css('display', 'none');\n                cFile = null;\n                _this.updFiles.call(_this);\n                theFile.trigger('onFileReady');\n            }\n            $('#ssk').click(function(e) {\n                e.preventDefault();\n                _this.files.ssk = cFile;\n                cluf();\n            });\n            $('#ssc').click(function(e) {\n                e.preventDefault();\n                _this.files.ssc = cFile;\n                cluf();\n            });\n            $('#pkg').click(function(e) {\n                e.preventDefault();\n                _this.files.pkg = cFile;\n                cluf();\n            });\n            $('#non').click(function(e) {\n                e.preventDefault();\n                cluf();\n            });\n\n            var dropBox = $('#ubox');\n\n            var file = $('input[type=\"file\"]');\n            file.on('change', function(e) {\n                _this.handleFiles.call(_this, file[0].files, 0);\n            });\n            dropBox.on('click', function() {\n                file.trigger('click');\n            });\n\n            dropBox[0].ondrop = function(e) {\n                e.preventDefault();\n                dropBox.removeClass('drop');\n                if(!e.dataTransfer) {\n                    return false;\n                }\n                var items;\n                if ((items = e.dataTransfer.items)) {\n                } else\n                if((items = e.dataTransfer.files)){\n                } else {\n                    return false;\n                }\n\n                var farr = _this.parseFileList.call(_this, items);\n                _this.handleFiles.call(_this, farr, 0);\n            }\n\n            dropBox[0].ondragover = function(e) {\n                e.preventDefault();\n                dropBox.addClass('drop');\n            }\n\n            dropBox[0].ondragleave = function(e) {\n                e.preventDefault();\n                dropBox.removeClass('drop');\n            }\n        }\n    }\n}();</script>","other":"\n    <div id=\"theUpload\" style=\"display:none;\" class=\"modal\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"uploadModal\" aria-hidden=\"true\">\n        <div class=\"dlg\">\n                <div class=\"ltop\">\n                <span>{{prg.lbl}}</span>\n            </div>\n            <div>\n                <div id=\"progOuter\"><div id=\"progInner\"></div><span id=\"progPercent\"></span></div>\n            </div>\n            <div style=\"clear:both;\"></div>\n                <div class=\"frm btn\" style=\"margin-right:0;\">\n                <button style=\"float:right;\" type=\"button\" name=\"abt\" id=\"abt\">{{prg.abt}}</button>\n            </div>\n                </div>\n    </div>\n    <div id=\"theFile\" style=\"display:none;\" class=\"modal\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"fileModal\" aria-hidden=\"true\">\n        <div class=\"dlg\">\n                <div class=\"ltop\">\n                <span>{{afl.sel}}</span>\n            </div>\n                <div class=\"frm btn\">\n                    <div style=\"display:inline-block;margin-top:-10px;\"><label>{{afl.fl}}:</label><div id=\"flval\" class=\"ldiv\"></div></div>\n                    <div style=\"clear:both;\"></div>\n                <button type=\"button\" name=\"ssk\" id=\"ssk\">{{afl.key}}</button>\n                <span style=\"width:20px;display:inline-block;\"></span>\n                <button type=\"button\" name=\"ssc\" id=\"ssc\">{{afl.crt}}</button>\n                <span style=\"width:20px;display:inline-block;\"></span>\n                <button type=\"button\" name=\"pkg\" id=\"pkg\">{{afl.pkg}}</button>\n                <span style=\"width:20px;display:inline-block;\"></span>\n                <button type=\"button\" name=\"non\" id=\"non\">{{afl.non}}</button>\n            </div>\n                </div>\n    </div>\n","content":"\n    <h3>{{upl.head}}</h3>\n    <pre>{{upl.txt}}</pre>\n    <div id=\"frmBox\">\n        <form id=\"theFrm\" class=\"frm min\">\n            <div id=\"box1\" style=\"float:left;\">\n                <input type=\"text\" style=\"display:none\">\n                <input type=\"password\" style=\"display:none\">\n                <label for=\"an\">{{frm.an}}*:</label><input type=\"text\" id=\"an\" name=\"an\" required=\"\">\n                <label for=\"dn\">{{frm.dn}}*:</label><input type=\"text\" id=\"dn\" name=\"dn\" pattern=\"^([a-zA-Z0-9]([a-zA-Z0-9\\-]{0,61}[a-zA-Z0-9])?\\.)+[a-zA-Z]{2,6}$\" required=\"\">\n                <label for=\"un\">{{frm.un}}*:</label><input type=\"text\" id=\"un\" name=\"un\" required=\"\">\n                <label for=\"up\">{{frm.up}}*:</label><input type=\"password\" id=\"up\" name=\"up\" required=\"\">\n                <label for=\"upr\">{{frm.upr}}*:</label><input type=\"password\" id=\"upr\" name=\"upr\" required=\"\">\n                <label>{{frm.ao}}:</label>\n                <div style=\"clear:both;\"></div>\n                <div class=\"noclear\">\n                    <label for=\"ac\">{{frm.ac}}</label>\n                    <input type=\"checkbox\" id=\"ac\" name=\"ac\" value=\"ac\" checked=\"\">\n                    <label for=\"ed\">{{frm.ed}}</label>\n                    <input type=\"checkbox\" id=\"ed\" name=\"ed\" value=\"ed\">\n                    <label for=\"ma\">{{frm.ma}}</label>\n                    <input type=\"checkbox\" id=\"ma\" name=\"ma\" value=\"ma\">\n                    <label for=\"di\">{{frm.di}}</label>\n                    <input type=\"checkbox\" id=\"di\" name=\"di\" value=\"di\">\n                </div>\n                <label for=\"ds\">{{frm.ds}} (MB):</label><input type=\"text\" id=\"ds\" name=\"ds\" pattern=\"[0-9]*\">\n                <label for=\"pp\">{{frm.pp}}:</label><input type=\"text\" id=\"pp\" name=\"pp\">\n                <div style=\"clear:both;\"></div>\n            </div>\n            <div id=\"box2\" style=\"float:left;\">\n                <input type=\"file\" style=\"display: none\">\n                <div id=\"ubox\">\n                    {{frm.drop}}\n                </div>\n                <label for=\"pf\">{{frm.pf}}:</label><div id=\"pf\" class=\"ldiv\">{{frm.no}}</div>\n                <label for=\"cc\">{{frm.cc}}:</label><div id=\"cc\" class=\"ldiv\">{{frm.no}}</div>\n                <label for=\"ck\">{{frm.ck}}:</label><div id=\"ck\" class=\"ldiv\">{{frm.no}}</div>\n                <label for=\"sc\">{{frm.sc}}</label><input type=\"checkbox\" id=\"sc\" name=\"sc\" value=\"sc\">\n                <label for=\"sn\">{{frm.sn}}:</label><input type=\"text\" id=\"sn\" name=\"sn\">\n                <label for=\"se\">{{frm.se}}</label>\n                <input type=\"checkbox\" id=\"se\" name=\"se\" value=\"se\">\n                <label for=\"on\">{{frm.on}}:</label><input type=\"text\" id=\"on\" name=\"on\" placeholder=\"{{frm.ef}}\">\n                <label for=\"eo\">{{frm.eo}}</label>\n                <input type=\"checkbox\" id=\"eo\" name=\"eo\" value=\"eo\">\n                <div style=\"clear:both;\"></div>\n                <div>\n                    <button type=\"submit\" style=\"float:right;margin-top:5px;margin-right:10px\">{{frm.sub}}</button>\n                </div>\n            </div>\n        </form>\n        <div style=\"clear:both;\"></div>\n    </div>\n"}}
